"use strict";(self["webpackChunkAG"]=self["webpackChunkAG"]||[]).push([[579],{6466:function(e,t,a){var s=a(82722),r=a(24806),i=a(99139),o=a(89467);const n={data(){return{editRowData:null,rowSelectedList:null,random6DigitNumber:(0,i.Oh)(),gridOptions:{rowHeight:36},agTableOptions:{theme:"alpine",style:null,agTableApi:null,initTable:null,initColumnDefs:null,columnDefs:[],rowData:[],gridOptions:null,defaultColDef:null},agQueryParams:{initTableSuccess:!0,getDataLoading:!0,totalPages:0,total:0,pageNum:1,pageSize:100,filterChangedObj:{},queryParam:{},toggleSearchStatus:!1}}},computed:{eventName(){const{initColumnDefs:e}=this.agTableOptions;return e&&e.agGridTableId?e.agGridTableId:void 0}},watch:{eventName(e){if(e){const t=this;r.iN.setEventBusListener(e,(e=>{t.agTableRowOperation(e)}))}}},beforeDestory(){this.eventName&&r.iN.removeEventBusListener(this.eventName),this.agTableOptions.agTableApi.gridApi.destroy(),this.agQueryParams.getDataLoading=!0,this.agTableOptions.style=null,this.agTableOptions.agTableApi=null,this.agTableOptions.initTable=null,this.agTableOptions.initColumnDefs=null,this.agTableOptions.defaultColDef=null,this.agTableOptions.gridOptions=null,this.agTableOptions.rowData=null,this.rowSelectedList=null,this.agQueryParams.filterChangedObj={},this.agQueryParams.queryParam={}},created(){if(!this.fieldsConfig)return o.error("ag-grid参数[fieldsConfig]是必填项"),!1;!1!==this.fieldsConfig.isDefaultDealQueryParamObj&&this.dealQueryParamObj(),!1!==this.fieldsConfig.isDefaultInitAgGridTable&&this.initTable()},methods:{getCustmoerGridOptions(){const e={rowHeight:80,headerHeight:60,rowSelection:"single",rowStyle:{backgroundColor:"#D3D3D3"},getRowHeight:function(e){return"bottom"===e.node.rowPinned?36:80}};return e},getCustomerDefaultColDef(){return{cellStyle:function(e){return"bottom"===e.node.rowPinned?{color:"#333","line-height":"36px",height:"36px"}:{color:"#ff0","line-height":"80px"}}}},dealQueryParamObj(){if(this.headerSearchConfig){const{main:t,more:a}=this.headerSearchConfig;if((0,s.isArray)(t)&&t.length){const r={};var e=[...t];(0,s.isArray)(a)&&a.length&&(e=[...t,...a]),e.forEach((e=>{const{field:t,type:a,defaultValue:s,selectDefaultValue:i,selectField:o}=e;"region"===a?r[t]=s||[]:(t&&(r[t]=s),o&&(r[o]=i))})),o.log("obj=====>",r),this.$set(this.agQueryParams,"queryParam",r),this.$set(this.agQueryParams,"isChangeQueryCondition",!1),this.$set(this.agQueryParams,"searchRequestCount",0),this.$set(this.agQueryParams,"resetQueryParams",(0,s.cloneDeep)(r))}}},searchReset(){o.log("查询=====12");const{queryParam:e,resetQueryParams:t}=this.agQueryParams;this.agQueryParams.searchRequestCount=0,this.agQueryParams=Object.assign(this.agQueryParams,{initTableSuccess:!0,getDataLoading:!1,totalPages:0,total:0,pageNum:1,pageSize:100,filterChangedObj:{},queryParam:Object.assign(e,t||{}),toggleSearchStatus:!1}),this.geAjaxList()},requestNextPage(e){o.log("请求下一页"),this.agQueryParams.totalPages>this.agQueryParams.pageNum&&(e?this.agQueryParams.pageNum=e:this.agQueryParams.pageNum++,this.geAjaxList(this.agQueryParams.queryParam))},rowSelected(e){o.log("获取多选的行数据",e);const t=this.agTableOptions.agTableApi.getSelectedRows(!1);o.log("获取多选的行数据123",t),this.rowSelectedList=t||[]},getRowData(e){this.editRowData=e},getGridApi(e){const t=new r.iN(e,this.fieldsConfig);o.log("agTableApi======>",t),this.agTableOptions.agTableApi=t},async initTable(){try{const{style:e}=this.fieldsConfig;this.agQueryParams.initTableSuccess=!1,this.agQueryParams.pageNum=1;const t=new r.nv,a=await t.judgeReadServerFieldsData(this.fieldsConfig);this.agTableOptions.columnDefs=a,this.agTableOptions.initColumnDefs=t,this.agTableOptions.initTable||(this.agTableOptions.initTable=this.initTable),e&&(0,s.isObject)(e)&&!(0,s.isEmpty)(e)&&(this.agTableOptions.style=e),this.agQueryParams.initTableSuccess=!0,this.geAjaxList()}catch(e){o.error("err=====>",e),this.$message.error(e?.message||"初始化表格函数[initTable]报错")}},geAjaxList(e={}){this.getList&&"function"===typeof this.getList?this.getList(e):!1!==this.fieldsConfig.isDefaultInitAgGridTable?o.error("getList查询接口方法是必要方法，请检查父组件是否有填写"):o.error("fieldsConfig对象中的[isDefaultInitAgGridTable]属性已经设置为false,请在父组件中methods编写[geAjaxList]方法替代混入的[geAjaxList]方法")}}};t.A=n},33579:function(e,t,a){a.r(t),a.d(t,{default:function(){return x}});var s=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"OrderManage"},[a("div",{staticClass:"OrderManage-header"},[a("div",{staticClass:"OrderManage-header-query"},[a("BLHeaderSearch",{ref:"BLHeaderSearch",attrs:{"header-search-config":e.headerSearchConfig,"ag-query-params":e.agQueryParams,"get-list":e.getList,"search-reset":e.searchReset}})],1),a("div",{staticClass:"OrderManage-header-btn"},[a("BLHeaderBtn",{attrs:{"row-selected-list":e.rowSelectedList,"btn-config-list":e.btnConfigList},on:{headerBtnOperation:e.headerBtnOperation}})],1)]),a("AgGridTable",{attrs:{"ag-table-options":e.agTableOptions,"ag-table-switch":{isScrollEndRequest:!0,drawerDoubleShow:!0,isShowExportExcelXlsxBtn:!0,isShowExportExcelCsvFile:!0,isShowExportExcelStyleXlsxFile:!0,isShowExportPdfFile:!0,isShowExportHtmlPdfFile:!0,isShowExportTextFile:!0,isShowExportJsonFile:!0,isShowExcelUpload:!0},"query-params":e.agQueryParams},on:{getRowData:e.getRowData,getGridApi:e.getGridApi,rowSelected:e.rowSelected,requestNextPage:e.requestNextPage}}),a("div",{staticClass:"webWorker"},[a("div",{staticClass:"webWorker-text"},[e._v(" "+e._s(e.webWorkerText)+" ")]),a("div",{staticClass:"webWorker-btn"},[a("BLButton",{on:{click:function(t){return e.killWebWorker()}}},[e._v("杀死进程")]),a("BLButton",[e._v("暂停进程")])],1)])],1)},r=[],i=a(95932),o=a(6466),n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{directives:[{name:"show",rawName:"v-show",value:"bottom"!==e.params.node.rowPinned,expression:"params.node.rowPinned !=='bottom'"}],staticClass:"AgRowActionBtn",on:{click:function(e){e.stopPropagation()}}},[a("BLButton",{staticClass:"AgRowActionBtn-btn",attrs:{type:"link"},on:{click:function(t){return e.operation(e.params,"删除")}}},[e._v("删除")])],1)},l=[],c=a(24806),g={name:"AgRowActionBtn",methods:{operation(e,t){const a=e.colDef.colId;a?c.iN.EventBus.$emit(a,{btnText:t,params:e}):this.$message.warning("表格操作事件colId未绑定，请联系管理员")}}},u=g,d=a(15627),p=(0,d.A)(u,n,l,!1,null,"54f7f8f2",null),h=p.exports,m=a(18604),f=a(87265),b=a(90465),y=a(89467);class T{constructor(e,t){(0,b.A)(this,"_myWorker",null),(0,b.A)(this,"_config",null),(0,b.A)(this,"_callback",null),this.init(e,t)}init(e,t){try{const{myWorker:a,...s}=e;if(!(a instanceof Worker))throw new Error("第一参数[options]需要传入myWorker实例");if(this._myWorker=a,"function"!==typeof t)throw new Error("第二参数[callback]需为函数");{this._callback=t;const e=this.getDealConfig(s);e&&(this._config=e,this.postMessageFun(e),this.listenAndDispatchMessage())}}catch(a){y.error(a?.message||"创建web worker失败")}}getDealConfig(e){const{pageOptions:t,requestOptions:a,exportFileOptions:s}=e,r={pageOptions:{requestParams:{url:t?.requestParams?.url,method:t?.requestParams?.method,data:{pageNum:t?.requestParams?.data?.pageNum,pageSize:t?.requestParams?.data?.pageSize||T.REQUEST_DEFAULT_PAGE_SIZE},headers:{Authorization:t?.requestParams?.headers?.Authorization}},pageParams:{total:t?.pageParams?.total,totalPage:t?.pageParams?.totalPage},sortabledFields:t?.sortabledFields||[]},requestOptions:{maxNum:a?.maxNum||T.REQUEST_DEFAULT_MAX_NUM,isRequestErrorAndStop:a?.isRequestErrorAndStop||T.IS_REQUEST_ERROR_AND_STOP,isDealResponseErrorAndStop:a?.isDealResponseErrorAndStop||T.IS_DEAL_RESPONSE_ERROR_AND_STOP,responseType:a?.responseType||T.REQUEST_RESPONSE_TYPE},exportFileOptions:{fileType:s?.fileType,fileName:s?.fileName||T.EXPORT_FILE_NAME,extName:s?.extName}},i=this.getExportFileType(r.exportFileOptions.fileType,r.exportFileOptions.fileName);if(y.log("nExportFileOptions",i),i){y.log("dealConfig=====>",r);const e=r?.pageOptions?.pageParams?.total,a=r?.pageOptions?.requestParams?.data?.pageNum,s=t?.requestParams?.data?.pageSize,o=r?.pageOptions?.requestParams?.data?.pageSize,n=Math.ceil((e-(a-1)*s)/o);return r.exportFileOptions=i,r.pageOptions.pageParams.totalPage=n,r}throw new Error("导出文件类型配置错误")}getExportFileType(e,t){if(t){const a={excel:{fileName:t,extName:".xlsx"},txt:{fileName:t,extName:".txt"},pdf:{fileName:t,extName:".pdf"},json:{fileName:t,extName:".json"}},s=a[e];if(y.log("fileTypeObj123123",s),s)return{fileType:e,...s}}}postMessageFun(e){this._myWorker.postMessage(e)}listenAndDispatchMessage(){const e=this;e._myWorker.onmessage=function(t){try{const a=t.data;y.log("监听并分发消息",a);const{message:s,data:r,status:i}=a;switch(i){case"config.processing":y.log("config.processing");break;case"config.success":y.log("config.success");break;case"config.failed":y.log("config.failed"),e.closeWorker();break;case"request.processing":y.log("request.processing",s),y.log("数据data=====>",r);break;case"request.success":y.log("request.success",s),y.log("数据data=====>",r);break;case"request.failed":y.log("request.failed");break;case"exportExcel.processing":y.log("exportExcel.processing"),r&&e.saveExcelFileByBolbArr(r,a?.fileNameObj);break;case"exportExcel.success":y.log("exportExcel.success");break;case"exportExcel.failed":y.log("exportExcel.failed"),e.closeWorker();break;default:y.log("default");break}e._callback(s)}catch(a){y.error(a?.message||"操作失败")}}}calcFileSizeByBuf(e,t="MB"){if("MB"===t){const t=e.byteLength/1024/1024,a=t.toFixed(2);return y.log(`Size in MB: ${a}`),a}if("KB"===t){const t=e.byteLength/1024,a=t.toFixed(2);return y.log(`Size in KB: ${a}`),a}}isFileSizeOverExportExcelLimit(e){const t=this.calcFileSizeByBuf(e);return t<=T.EXPORT_EXCEL_FILE_SIZE_LIMIT}formatDateStr(e){return e>9?e:"0"+e}formatSpecDate(e=0){let t=new Date;const a=this.formatDateStr;if(e){const a=t.getTime()+60*e*1e3*60;t=new Date(a)}const s=t.getFullYear(),r=t.getMonth()+1,i=t.getDate(),o=t.getHours(),n=t.getMinutes();return`${s}${a(r)}${a(i)}${a(o)}${a(n)}`}saveExcelFileByBolbArr(e,t){if(!Array.isArray(e)||!e.length)throw new Error("导出失败,未获取到二进制数据");{const a=this;e.forEach(((e,s)=>{if(e){const r=a.formatSpecDate();let i=`${r}-downLoadExcel-${s+1}.xlsx`;t?.fileName&&t?.extName&&(i=`${r}-${t.fileName}-${s+1}${t.extName}`),a.saveExcelFileByBolb(e,i)}}))}}saveExcelFileByBolb(e,t){const a=this.calcFileSizeByBuf(e),s=T.EXPORT_EXCEL_FILE_SIZE_LIMIT,r=a<=s;if(!r)throw new Error(`导出失败,当前数据大小为【${a}】已超出导出最大限制【${s}】`);(0,f.saveAs)(new Blob([e],{type:"application/octet-stream"}),t)}closeWorker(){this._myWorker?.terminate()}stopWorkerAjaxRequest(){}}(0,b.A)(T,"EXPORT_EXCEL_FILE_SIZE_LIMIT",90),(0,b.A)(T,"REQUEST_DEFAULT_PAGE_SIZE",5e3),(0,b.A)(T,"REQUEST_DEFAULT_MAX_NUM",3),(0,b.A)(T,"IS_REQUEST_ERROR_AND_STOP",!1),(0,b.A)(T,"IS_DEAL_RESPONSE_ERROR_AND_STOP",!1),(0,b.A)(T,"REQUEST_RESPONSE_TYPE","file"),(0,b.A)(T,"EXPORT_FILE_NAME","Download File");var P=a(89467),w={name:"OrderManage",mixins:[o.A],components:{AgRowActionBtn:h},data(){return{headerSearchConfig:{displayIndex:2,main:[{type:"fuzzySearch",field:"searchVal",selectField:"inField",defaultValue:void 0,selectDefaultValue:"orderNo",options:[{label:"订单号",value:"orderNo"}]},{type:"dateTimeSearch",field:"dateTime",selectField:"commonTime",defaultValue:void 0,selectDefaultValue:"startTime,endTime",options:[{label:"创建时间",value:"startTime,endTime"},{label:"更新时间",value:"updateTime"}]}]},btnConfigList:[{btnText:"批量请求[classic]",type:"primary",power:"getTransportNode"},{btnText:"批量请求[module]",type:"primary",power:"getTransportNode"},{btnText:"操作",type:"primary",power:"getTransportNode"},{btnText:"批量操作",btnType:"dropdown",afterIcon:"down",ghost:!0,power:"batchOperation",menuItems:[{btnText:"删除",icon:"delete",style:"color:red;",power:"batchDelete"}]}],fieldsConfig:{name:"订单管理",id:"OrderManage",database:{"订单号":"orderNo","托运单单号":"noteNo","客户单号":"customerNo","来源单号":"sourceNo","订单时间":"orderDate","分段数量":"orderSplitCount","订单状态":"orderState","财务审核状态":"financeAuditState","对账状态":"billState","核销状态":"verifyoffState","跟踪状态":"trackState","是否干线出库":"isMiddle","是否对接":"isJoin","对接公司":"joinCompanyName","对接项目部名称":"joinProdivisionName","是否系统内组织":"isSystemInside","货物性质":"goodsNature","订单件数":"orderNum","订单重量":"orderWeight","订单体积":"orderVolume","计费重量":"calculationWeight","计费体积":"calculationVolume","干线单价":"calculationPrice1","干线单价2":"calculationPrice2","提货单价":"deliveryPrice1","提货单价2":"deliveryPrice2","送货单价":"sendPrice1","送货单价2":"sendPrice2","计算方式":"calculateMode","阶梯类型":"ladderType","增减费合计":"addCutFee","产品类型":"productType","运输类型":"transitType","发站":"beginSite","到站":"endSite","发货人":"beginMan","发货公司":"beginCompany","发货人电话":"beginPhone","始发省":"beginProvince","始发市":"beginCity","始发区":"beginArea","始发街道":"beginStreet","发货详细地址":"beginAddress","收货人":"endMan","收货公司":"endCompany","收货人电话":"endPhone","目的省":"endProvince","目的市":"endCity","目的区":"endArea","目的街道":"endStreet","收货详细地址":"endAddress","交接方式":"handoverMode","现付":"nowPay","现付对账剩余金额":"surplusNowPay","提付":"fetchPay","提付对账剩余金额":"surplusFetchPay","月结":"monthPay","月结对账剩余金额":"surplusMonthPay","回单付":"receiptPay","送货费":"terminalFee","提货费":"deliveryFee","已核销金额":"verifyoffMoney","支付方式":"paymentMode","客户名称":"customerName","客户公司":"customerCompany","服务方式":"serviceFormula","增值服务费合计":"otherFee","基本运费":"basicFee","总运费":"totalFee","总收入合计":"totalIn","计费方式":"calculateStandardName","车型":"carType","车长":"carLength","是否回单":"isReceipt","回单份数":"receiptNum","回单要求":"receiptRequirement","成本分摊":"costShare","成本率(%)":"costRate","提货成本分摊":"deliveryCost","干线成本分摊":"trunklineCost","整车成本分摊":"vehicleCost","送货成本分摊":"terminalCost","作废人":"cancelMan","作废时间":"cancelDate","订单审核人":"orderAuditMan","订单审核时间":"orderAuditDate","声明价值":"declaredValue","付款人":"payMan","项目部":"prodivisionName","业务员":"salesMan","业务员电话":"salesManPhone","业务所属部门":"salesDept","服务类型":"taxType","干线运费":"trunklineFee","税率/干线运费税率":"taxRate","订单不含税金额":"notTaxMoney","不含税干线运费":"trunkLineFeeNoTax","物流辅助费":"assistFee","物流辅助费税率":"assistFeeRate","不含税物流辅助费":"assistFeeNoTax","物流辅助费对账剩余金额":"surplusAssistFee","货运代理费":"agencyFee","货运代理费税率":"agencyFeeRate","不含税货运代理费":"agencyFeeNoTax","货运代理费对账剩余金额":"surplusAgencyFee","销项税金":"realTax","服务费成本分摊":"serviceCost","货物名称":"goodsNameOne","开单人":"createdBy","开单时间":"createdTime","修改人":"updatedBy","修改时间":"updatedTime","要求提货时间":"deliveryDate","要求到达时间":"arriveDate","合同主体":"invoiceMain","订单备注":"orderRemark","操作来源":"operationType"},specColumns:[],actionColumns:[{headerName:"操作",field:"agTableAction",width:80,cellRendererFramework:"AgRowActionBtn"}]},webWorkerText:"提示语",myWorker:null,tmyWorker:null}},methods:{searchQuery(e){this.$refs.BLHeaderSearch.searchQuery(e)},getList(e){const{pageSize:t,pageNum:a,filterChangedObj:s}=this.agQueryParams;this.agQueryParams.queryParam.isRealField=!0,this.agQueryParams.getDataLoading=!0,1===a&&(this.agTableOptions.rowData=null),this.rowSelectedList=null,(0,i.n7)({pageSize:t,pageNum:a,...e||{},...s.filterObj||{}}).then((e=>{if(P.log("res123======>",e),200===e?.code){const{data:t,total:s=0,pages:r}=e;this.agQueryParams.total=s,this.agQueryParams.totalPages=r,this.agTableOptions.rowData=a<=1?Object.freeze(t):Object.freeze([...this.agTableOptions.rowData,...t])}else this.$message.error(e.message||"查询列表失败")})).finally((()=>{this.agQueryParams.getDataLoading=!1}))},deleteConfirm(e){const t=this;t.$confirm({title:"操作确认",content:"删除后无法恢复，您是否确认删除?",onOk:async function(){P.log("提交");const a=await(0,i.OM)({ids:e});200===a.code?(t.$message.success("删除成功"),t.getList(t.agQueryParams.queryParam)):t.$message.warning(a.message||"删除失败")}})},batchDelData(e){if(e?.length){const t=e.map((e=>e.id)).join(",");this.deleteConfirm(t)}else this.$message.warning("未选择数据")},headerBtnOperation(e){P.log("头部按钮操作",e);const{btnText:t}=e;switch(t){case"批量请求[classic]":P.log("批量请求[classic]"),this.rushDoBatchRequest();break;case"批量请求[module]":P.log("批量请求[module]"),this.rushDoBatchRequest1();break;case"操作":P.log("操作",this.agQueryParams);break;case"删除":P.log("删除");break;case"批量操作-删除":P.log("批量操作-删除"),this.batchDelData(this.rowSelectedList);break}},agTableRowOperation(e){const{params:t,btnText:a}=e,s=t.data;switch(this.selectedRowInfo=s,a){case"删除":P.log("删除"),this.deleteConfirm(s.id);break}},getSortabledFields(){const e=this.agTableOptions.initColumnDefs.sortabledFields;P.log("sortabledFields",e);let t=[],a=[];return e.forEach((e=>{e.hide||(t.push(e.headerName),a.push(e.field))})),{tHeader:t,filterVal:a}},getWorkerOptions(){const e=this,{pageNum:t,pageSize:a,total:s}=this.agQueryParams,r=a,i=Math.ceil((s-(t-1)*a)/r);P.log("totalPage",i);const o=m.c7("token"),n={pageOptions:{requestParams:{url:"/api/order/list",method:"post",data:{pageNum:t,pageSize:r},headers:{Authorization:`Bearer ${o}`}},pageParams:{total:s,totalPage:i},sortabledFields:e.agTableOptions.initColumnDefs.sortabledFields},requestOptions:{maxNum:2,responseType:"file"},exportFileOptions:{fileType:"excel",fileName:"订单管理"}};return n},rushDoBatchRequest(){P.log("执行批量请求");const e=this;if(window.Worker){this.tmyWorker&&this.tmyWorker?.terminate();const t=new Worker(new URL(a.p+a.u(61),a.b));this.tmyWorker=t,t.onmessage=function(t){const a=t.data;P.log("请求获取到参数",a);const{message:s,postResult:r,status:i}=a;e.webWorkerText=s,P.log("postResult123123",r);const o=e=>{(0,f.saveAs)(new Blob([e],{type:"application/octet-stream"}),"test.xlsx")};switch(i){case"processing":P.log("processing");break;case"success":P.log("success"),o(r);break}};const{pageNum:s,pageSize:r,total:i}=this.agQueryParams,o=r,n=Math.ceil((i-s*r)/o),l=m.c7("token");t.postMessage({requestParams:{url:"/api/order/list",method:"post",data:{pageNum:s,pageSize:o},headers:{Authorization:`Bearer ${l}`}},pageParams:{total:i,totalPage:n},sortabledFields:e.agTableOptions.initColumnDefs.sortabledFields})}else P.log("Your browser does not support Web Workers.")},rushDoBatchRequest1(){P.log("执行批量请求");const e=this;if(window.Worker){P.log("import.meta.url","file:///D:/project/blqc-ag-grid/vue2_antd_agGrid2/src/views/pages/order/order-manage/index.vue%3Fvue&type=script&lang=js");const t=new Worker(new URL(a.p+a.u(282),a.b)),s=new URL(a(20753),a.b);P.log("url123123",s);const r=this.getWorkerOptions();P.log("options123123123",r);const i=new T({myWorker:t,...r},(t=>{P.log("父界面获取参数=====>",t),e.webWorkerText=t}));P.log("cWorker",i),this.myWorker=i}else P.log("Your browser does not support Web Workers.")},killWebWorker(){this.myWorker?.closeWorker()}}},S=w,E=(0,d.A)(S,s,r,!1,null,"e42d359c",null),x=E.exports},20753:function(e,t,a){e.exports=a.p+"ae258dbebdbe50a5.js"}}]);
//# sourceMappingURL=579.5cb98e06.js.map