"use strict";(self["webpackChunkAG"]=self["webpackChunkAG"]||[]).push([[279],{6466:function(e,t,a){var i=a(82722),s=a(24806),n=a(99139),r=a(89467);const o={data(){return{editRowData:null,rowSelectedList:null,random6DigitNumber:(0,n.Oh)(),gridOptions:{rowHeight:36},agTableOptions:{theme:"alpine",style:null,agTableApi:null,initTable:null,initColumnDefs:null,columnDefs:[],rowData:[],gridOptions:null,defaultColDef:null},agQueryParams:{initTableSuccess:!0,getDataLoading:!0,totalPages:0,total:0,pageNum:1,pageSize:100,filterChangedObj:{},queryParam:{},toggleSearchStatus:!1}}},computed:{eventName(){const{initColumnDefs:e}=this.agTableOptions;return e&&e.agGridTableId?e.agGridTableId:void 0}},watch:{eventName(e){if(e){const t=this;s.iN.setEventBusListener(e,(e=>{t.agTableRowOperation(e)}))}}},beforeDestory(){this.eventName&&s.iN.removeEventBusListener(this.eventName),this.agTableOptions.agTableApi.gridApi.destroy(),this.agQueryParams.getDataLoading=!0,this.agTableOptions.style=null,this.agTableOptions.agTableApi=null,this.agTableOptions.initTable=null,this.agTableOptions.initColumnDefs=null,this.agTableOptions.defaultColDef=null,this.agTableOptions.gridOptions=null,this.agTableOptions.rowData=null,this.rowSelectedList=null,this.agQueryParams.filterChangedObj={},this.agQueryParams.queryParam={}},created(){if(!this.fieldsConfig)return r.error("ag-grid参数[fieldsConfig]是必填项"),!1;!1!==this.fieldsConfig.isDefaultDealQueryParamObj&&this.dealQueryParamObj(),!1!==this.fieldsConfig.isDefaultInitAgGridTable&&this.initTable()},methods:{getCustmoerGridOptions(){const e={rowHeight:80,headerHeight:60,rowSelection:"single",rowStyle:{backgroundColor:"#D3D3D3"},getRowHeight:function(e){return"bottom"===e.node.rowPinned?36:80}};return e},getCustomerDefaultColDef(){return{cellStyle:function(e){return"bottom"===e.node.rowPinned?{color:"#333","line-height":"36px",height:"36px"}:{color:"#ff0","line-height":"80px"}}}},dealQueryParamObj(){if(this.headerSearchConfig){const{main:t,more:a}=this.headerSearchConfig;if((0,i.isArray)(t)&&t.length){const s={};var e=[...t];(0,i.isArray)(a)&&a.length&&(e=[...t,...a]),e.forEach((e=>{const{field:t,type:a,defaultValue:i,selectDefaultValue:n,selectField:r}=e;"region"===a?s[t]=i||[]:(t&&(s[t]=i),r&&(s[r]=n))})),r.log("obj=====>",s),this.$set(this.agQueryParams,"queryParam",s),this.$set(this.agQueryParams,"isChangeQueryCondition",!1),this.$set(this.agQueryParams,"searchRequestCount",0),this.$set(this.agQueryParams,"resetQueryParams",(0,i.cloneDeep)(s))}}},searchReset(){r.log("查询=====12");const{queryParam:e,resetQueryParams:t}=this.agQueryParams;this.agQueryParams.searchRequestCount=0,this.agQueryParams=Object.assign(this.agQueryParams,{initTableSuccess:!0,getDataLoading:!1,totalPages:0,total:0,pageNum:1,pageSize:100,filterChangedObj:{},queryParam:Object.assign(e,t||{}),toggleSearchStatus:!1}),this.geAjaxList()},requestNextPage(e){r.log("请求下一页"),this.agQueryParams.totalPages>this.agQueryParams.pageNum&&(e?this.agQueryParams.pageNum=e:this.agQueryParams.pageNum++,this.geAjaxList(this.agQueryParams.queryParam))},rowSelected(e){r.log("获取多选的行数据",e);const t=this.agTableOptions.agTableApi.getSelectedRows(!1);r.log("获取多选的行数据123",t),this.rowSelectedList=t||[]},getRowData(e){this.editRowData=e},getGridApi(e){const t=new s.iN(e,this.fieldsConfig);r.log("agTableApi======>",t),this.agTableOptions.agTableApi=t},async initTable(){try{const{style:e}=this.fieldsConfig;this.agQueryParams.initTableSuccess=!1,this.agQueryParams.pageNum=1;const t=new s.nv,a=await t.judgeReadServerFieldsData(this.fieldsConfig);this.agTableOptions.columnDefs=a,this.agTableOptions.initColumnDefs=t,this.agTableOptions.initTable||(this.agTableOptions.initTable=this.initTable),e&&(0,i.isObject)(e)&&!(0,i.isEmpty)(e)&&(this.agTableOptions.style=e),this.agQueryParams.initTableSuccess=!0,this.geAjaxList()}catch(e){r.error("err=====>",e),this.$message.error(e?.message||"初始化表格函数[initTable]报错")}},geAjaxList(e={}){this.getList&&"function"===typeof this.getList?this.getList(e):!1!==this.fieldsConfig.isDefaultInitAgGridTable?r.error("getList查询接口方法是必要方法，请检查父组件是否有填写"):r.error("fieldsConfig对象中的[isDefaultInitAgGridTable]属性已经设置为false,请在父组件中methods编写[geAjaxList]方法替代混入的[geAjaxList]方法")}}};t.A=o},34279:function(e,t,a){a.r(t),a.d(t,{default:function(){return G}});var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"BaiduMap"},[a("a-tabs",{attrs:{"default-active-key":e.activeName,size:"small"}},[a("a-tab-pane",{key:"电子围栏",staticClass:"BaiduMapTab",attrs:{tab:"电子围栏"}},[a("ElectronicFence")],1),a("a-tab-pane",{key:"地图轨迹",staticClass:"BaiduMapTab",attrs:{tab:"地图轨迹"}},[a("MapTrajectory")],1),a("a-tab-pane",{key:"地图相关组件",staticClass:"BaiduMapTab",attrs:{tab:"地图相关组件"}},[a("MapComponents")],1),a("a-tab-pane",{key:"地图相关工具函数",staticClass:"BaiduMapTab",attrs:{tab:"地图相关工具函数"}},[a("MapTools")],1)],1)],1)},s=[],n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"ElectronicFence"},[a("div",{staticClass:"ElectronicFence-header"},[a("div",{staticClass:"ElectronicFence-header-query"},[a("BLHeaderSearch",{ref:"BLHeaderSearch",attrs:{"header-search-config":e.headerSearchConfig,"ag-query-params":e.agQueryParams,"get-list":e.getList,"search-reset":e.searchReset}})],1),a("div",{staticClass:"ElectronicFence-header-btn"},[a("BLHeaderBtn",{attrs:{"row-selected-list":e.rowSelectedList,"btn-config-list":e.btnConfigList},on:{headerBtnOperation:e.headerBtnOperation}})],1)]),a("AgGridTable",{attrs:{"ag-table-options":e.agTableOptions,"ag-table-switch":{isScrollEndRequest:!0,isShowExcelDownload:!0,drawerDoubleShow:!0},"query-params":e.agQueryParams},on:{getRowData:e.getRowData,getGridApi:e.getGridApi,rowSelected:e.rowSelected,requestNextPage:e.requestNextPage}}),a("AddFenceDialog",{attrs:{visible:e.openAddFenceDialog,rowInfo:e.selectedAddFenceRowInfo},on:{"update:visible":function(t){e.openAddFenceDialog=t},success:e.searchQuery}})],1)},r=[],o=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{directives:[{name:"show",rawName:"v-show",value:"bottom"!==e.params.node.rowPinned,expression:"params.node.rowPinned !=='bottom'"}],staticClass:"AgRowActionBtn",on:{click:function(e){e.stopPropagation()}}},[a("BLButton",{staticClass:"AgRowActionBtn-btn",attrs:{type:"link",power:"edit"},on:{click:function(t){return e.operation(e.params,"修改")}}},[e._v("修改")]),a("BLButton",{staticClass:"AgRowActionBtn-btn",staticStyle:{color:"red"},attrs:{type:"link",power:"delete"},on:{click:function(t){return e.operation(e.params,"删除")}}},[e._v("删除")])],1)},l=[],c=a(24806),d={name:"AgRowActionBtn",methods:{operation(e,t){const a=e.colDef.colId;a?c.iN.EventBus.$emit(a,{btnText:t,params:e}):this.$message.warning("表格操作事件colId未绑定，请联系管理员")}}},g=d,u=a(15627),h=(0,u.A)(g,o,l,!1,null,"316fc982",null),p=h.exports,m=a(6466),f=a(95932),b=a(89467),y={name:"ElectronicFence",components:{AgRowActionBtn:p,AddFenceDialog:()=>a.e(477).then(a.bind(a,5477))},mixins:[m.A],data(){return{headerSearchConfig:{displayIndex:2,main:[{type:"fuzzySearch",field:"searchVal",selectField:"inField",defaultValue:void 0,selectDefaultValue:"name",options:[{label:"围栏名称",value:"name"},{label:"围栏编码",value:"code"}]},{type:"select",field:"type",defaultValue:void 0,placeholder:"请选择围栏类型",options:[]},{type:"select",field:"category",defaultValue:void 0,placeholder:"请选择围栏类别",options:[]}]},btnConfigList:[{btnText:"新增",type:"primary",power:"add"},{btnText:"批量删除",type:"danger",ghost:!0,loading:!1,power:"batchDelete"},{btnText:"导入",power:"import"}],fieldsConfig:{name:"电子围栏",id:"ElectronicFence",database:{"围栏编码":"code","围栏名称":"name","围栏类型":"type","围栏类别":"category","半径":"radius","面积":"size","经度":"longitude","纬度":"latitude","详细地址":"address","备注":"remark","创建人":"createBy","创建时间":"createdAt","更新人":"updateBy","更新时间":"updatedAt"},specColumns:[],actionColumns:[{headerName:"操作",field:"agTableAction",width:120,cellRendererFramework:"AgRowActionBtn"}]},dialogSelectedRowInfo:null,openAddFenceDialog:!1,selectedAddFenceRowInfo:null,dictObj:{5:[],26:[]}}},created(){this.getDicItems()},methods:{searchQuery(e){this.$refs.BLHeaderSearch.searchQuery(e)},async getDicItems(){const e={5:[],26:[]},t=Object.keys(e).join(","),a=await(0,f.O_)(t),i=a?.data||[];i.forEach((t=>{t.dicBindId&&(t.label=t.dicLabel,t.value=t.dicValue,e[t.dicBindId].push(t))})),this.dictObj=e,this.headerSearchConfig.main[1].options=e["26"],this.headerSearchConfig.main[2].options=e["5"],b.log("dictObj=====>",e)},getList(e){const{pageSize:t,pageNum:a,filterChangedObj:i}=this.agQueryParams;this.agQueryParams.queryParam.isRealField=!0,this.agQueryParams.getDataLoading=!0,1===a&&(this.agTableOptions.rowData=null),this.rowSelectedList=null,(0,f["if"])({pageSize:t,pageNum:a,queryParams:{...e||{},...i.filterObj||{}}}).then((e=>{if(200===e.code){b.log("res======>",e);const{data:t,total:i=0,pages:s}=e;this.agQueryParams.total=i,this.agQueryParams.totalPages=s,this.agTableOptions.rowData=a<=1?t:[...this.agTableOptions.rowData,...t]}else this.$message.error(e.message||"查询列表失败")})).finally((()=>{this.agQueryParams.getDataLoading=!1}))},agTableRowOperation(e){const{params:t,btnText:a}=e;b.log("params",t);const i=t.data;switch(a){case"修改":b.log("修改"),this.openEditAddFenceDialog(i);break;case"删除":b.log("删除"),this.deleteConfirm(i.id);break}},openEditAddFenceDialog(e){this.selectedAddFenceRowInfo=e,this.openAddFenceDialog=!0},deleteConfirm(e){const t=this;this.$confirm({title:"操作确认",content:"删除后无法恢复，您是否确认删除?",onOk:function(){b.log("提交"),(0,f.J7)({ids:e}).then((e=>{200===e.code&&(t.$message.success("删除成功"),t.searchQuery())}))}})},batchDeleteConfirm(){const e=this.rowSelectedList;if(e.length<=0)return void this.$message.warning("请至少选择一条数据");const t=e.map((e=>e.id)),a=t.join(","),i=this;this.$confirm({title:"操作确认",content:"删除后无法恢复，您是否确认删除?",onOk:async function(){b.log("提交");const e=await(0,f.J7)({ids:a});200===e.code?(i.$message.success("删除成功"),i.searchQuery()):i.$message.warning(e.message||"删除失败")}})},headerBtnOperation(e){b.log("头部按钮操作",e);const{btnText:t}=e;if(!["删除","方案配置","自动打卡开启","批量删除"].includes(t)||this.rowSelectedList&&this.rowSelectedList.length)switch(b.log("this.rowSelectedList",this.rowSelectedList),t){case"新增":b.log("新增"),this.selectedAddFenceRowInfo=null,this.openAddFenceDialog=!0;break;case"下载模板":b.log("下载模板");break;case"导入":b.log("导入");break;case"批量删除":b.log("批量删除"),this.batchDeleteConfirm();break}else this.$message.warning("未选中行数据")}}},w=y,T=(0,u.A)(w,n,r,!1,null,"fb19fee4",null),A=T.exports,C=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[e._v("12313")])},D=[],P={name:"MapComponents"},v=P,O=(0,u.A)(v,C,D,!1,null,"02d47d94",null),S=O.exports,Q=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[e._v("12313")])},L=[],B={name:"ElectronicFence"},F=B,x=(0,u.A)(F,Q,L,!1,null,"3ca998f8",null),R=x.exports,j=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[e._v("12313")])},k=[],E={name:"ElectronicFence"},N=E,$=(0,u.A)(N,j,k,!1,null,"6e20d8e0",null),I=$.exports,_={name:"BaiduMap",components:{ElectronicFence:A,MapComponents:S,MapTools:R,MapTrajectory:I},data(){return{activeName:"电子围栏"}}},q=_,M=(0,u.A)(q,i,s,!1,null,"135315cc",null),G=M.exports}}]);
//# sourceMappingURL=279.ed76406f.js.map