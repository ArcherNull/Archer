"use strict";(self["webpackChunkAG"]=self["webpackChunkAG"]||[]).push([[17],{6466:function(e,t,a){var s=a(82722),i=a(24806),r=a(99139),l=a(89467);const o={data(){return{editRowData:null,rowSelectedList:null,random6DigitNumber:(0,r.Oh)(),gridOptions:{rowHeight:36},agTableOptions:{theme:"alpine",style:null,agTableApi:null,initTable:null,initColumnDefs:null,columnDefs:[],rowData:[],gridOptions:null,defaultColDef:null},agQueryParams:{initTableSuccess:!0,getDataLoading:!0,totalPages:0,total:0,pageNum:1,pageSize:100,filterChangedObj:{},queryParam:{},toggleSearchStatus:!1}}},computed:{eventName(){const{initColumnDefs:e}=this.agTableOptions;return e&&e.agGridTableId?e.agGridTableId:void 0}},watch:{eventName(e){if(e){const t=this;i.iN.setEventBusListener(e,(e=>{t.agTableRowOperation(e)}))}}},beforeDestory(){this.eventName&&i.iN.removeEventBusListener(this.eventName),this.agTableOptions.agTableApi.gridApi.destroy(),this.agQueryParams.getDataLoading=!0,this.agTableOptions.style=null,this.agTableOptions.agTableApi=null,this.agTableOptions.initTable=null,this.agTableOptions.initColumnDefs=null,this.agTableOptions.defaultColDef=null,this.agTableOptions.gridOptions=null,this.agTableOptions.rowData=null,this.rowSelectedList=null,this.agQueryParams.filterChangedObj={},this.agQueryParams.queryParam={}},created(){if(!this.fieldsConfig)return l.error("ag-grid参数[fieldsConfig]是必填项"),!1;!1!==this.fieldsConfig.isDefaultDealQueryParamObj&&this.dealQueryParamObj(),!1!==this.fieldsConfig.isDefaultInitAgGridTable&&this.initTable()},methods:{getCustmoerGridOptions(){const e={rowHeight:80,headerHeight:60,rowSelection:"single",rowStyle:{backgroundColor:"#D3D3D3"},getRowHeight:function(e){return"bottom"===e.node.rowPinned?36:80}};return e},getCustomerDefaultColDef(){return{cellStyle:function(e){return"bottom"===e.node.rowPinned?{color:"#333","line-height":"36px",height:"36px"}:{color:"#ff0","line-height":"80px"}}}},dealQueryParamObj(){if(this.headerSearchConfig){const{main:t,more:a}=this.headerSearchConfig;if((0,s.isArray)(t)&&t.length){const i={};var e=[...t];(0,s.isArray)(a)&&a.length&&(e=[...t,...a]),e.forEach((e=>{const{field:t,type:a,defaultValue:s,selectDefaultValue:r,selectField:l}=e;"region"===a?i[t]=s||[]:(t&&(i[t]=s),l&&(i[l]=r))})),l.log("obj=====>",i),this.$set(this.agQueryParams,"queryParam",i),this.$set(this.agQueryParams,"isChangeQueryCondition",!1),this.$set(this.agQueryParams,"searchRequestCount",0),this.$set(this.agQueryParams,"resetQueryParams",(0,s.cloneDeep)(i))}}},searchReset(){l.log("查询=====12");const{queryParam:e,resetQueryParams:t}=this.agQueryParams;this.agQueryParams.searchRequestCount=0,this.agQueryParams=Object.assign(this.agQueryParams,{initTableSuccess:!0,getDataLoading:!1,totalPages:0,total:0,pageNum:1,pageSize:100,filterChangedObj:{},queryParam:Object.assign(e,t||{}),toggleSearchStatus:!1}),this.geAjaxList()},requestNextPage(e){l.log("请求下一页"),this.agQueryParams.totalPages>this.agQueryParams.pageNum&&(e?this.agQueryParams.pageNum=e:this.agQueryParams.pageNum++,this.geAjaxList(this.agQueryParams.queryParam))},rowSelected(e){l.log("获取多选的行数据",e);const t=this.agTableOptions.agTableApi.getSelectedRows(!1);l.log("获取多选的行数据123",t),this.rowSelectedList=t||[]},getRowData(e){this.editRowData=e},getGridApi(e){const t=new i.iN(e,this.fieldsConfig);l.log("agTableApi======>",t),this.agTableOptions.agTableApi=t},async initTable(){try{const{style:e}=this.fieldsConfig;this.agQueryParams.initTableSuccess=!1,this.agQueryParams.pageNum=1;const t=new i.nv,a=await t.judgeReadServerFieldsData(this.fieldsConfig);this.agTableOptions.columnDefs=a,this.agTableOptions.initColumnDefs=t,this.agTableOptions.initTable||(this.agTableOptions.initTable=this.initTable),e&&(0,s.isObject)(e)&&!(0,s.isEmpty)(e)&&(this.agTableOptions.style=e),this.agQueryParams.initTableSuccess=!0,this.geAjaxList()}catch(e){l.error("err=====>",e),this.$message.error(e?.message||"初始化表格函数[initTable]报错")}},geAjaxList(e={}){this.getList&&"function"===typeof this.getList?this.getList(e):!1!==this.fieldsConfig.isDefaultInitAgGridTable?l.error("getList查询接口方法是必要方法，请检查父组件是否有填写"):l.error("fieldsConfig对象中的[isDefaultInitAgGridTable]属性已经设置为false,请在父组件中methods编写[geAjaxList]方法替代混入的[geAjaxList]方法")}}};t.A=o},68017:function(e,t,a){a.r(t),a.d(t,{default:function(){return v}});var s=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"BasePage"},[a("div",{staticClass:"BasePage-header"},[a("div",{staticClass:"BasePage-header-query"},[a("BLHeaderSearch",{ref:"BLHeaderSearch",attrs:{"header-search-config":e.headerSearchConfig,"ag-query-params":e.agQueryParams,"get-list":e.getList,"search-reset":e.searchReset}})],1),a("div",{staticClass:"BasePage-header-btn"},[a("BLHeaderBtn",{attrs:{"row-selected-list":e.rowSelectedList,"btn-config-list":e.btnConfigList},on:{headerBtnOperation:e.headerBtnOperation}})],1)]),a("AgGridTable",{attrs:{"ag-table-options":Object.assign({},e.agTableOptions,{gridOptions:e.getCustmoerGridOptions,defaultColDef:e.getCustomerDefaultColDef}),"ag-table-switch":{isScrollEndRequest:!0,drawerDoubleShow:!0},"query-params":e.agQueryParams},on:{getRowData:e.getRowData,getGridApi:e.getGridApi,rowSelected:e.rowSelected,requestNextPage:e.requestNextPage}}),a("AddUser",{attrs:{visible:e.openAddUser,rowInfo:e.selectedRowInfo},on:{"update:visible":function(t){e.openAddUser=t},success:e.searchQuery}})],1)},i=[],r=a(6466),l=a(95932),o=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{directives:[{name:"show",rawName:"v-show",value:"bottom"!==e.params.node.rowPinned,expression:"params.node.rowPinned !=='bottom'"}],staticClass:"AgRowActionBtn",on:{click:function(e){e.stopPropagation()}}},[a("BLButton",{staticClass:"AgRowActionBtn-btn",attrs:{type:"link"},on:{click:function(t){return e.operation(e.params,"编辑")}}},[e._v("编辑")]),a("BLButton",{staticClass:"AgRowActionBtn-btn",attrs:{type:"link"},on:{click:function(t){return e.operation(e.params,1===e.params.data.userState?"禁用":"启用")}}},[e._v(e._s(1===e.params.data.userState?"禁用":"启用"))]),a("BLButton",{staticClass:"AgRowActionBtn-btn",attrs:{type:"link"},on:{click:function(t){return e.operation(e.params,"删除")}}},[e._v("删除")])],1)},n=[],g=a(24806),u=a(89467),d={name:"AgRowActionBtn",methods:{operation(e,t){u.log("params",e);const a=e.colDef.colId;a?(u.log("colId=====>",a),g.iN.EventBus.$emit(a,{btnText:t,params:e})):this.$message.warning("表格操作事件colId未绑定，请联系管理员"),this.$emit("button-click","Button clicked!")}}},c=d,h=a(15627),m=(0,h.A)(c,o,n,!1,null,"361bf916",null),p=m.exports,b=a(89467),f={name:"BasePage",mixins:[r.A],components:{AgRowActionBtn:p,AddUser:()=>a.e(875).then(a.bind(a,90875))},data(){return{headerSearchConfig:{displayIndex:2,main:[{type:"fuzzySearch",field:"searchVal",selectField:"inField",defaultValue:void 0,selectDefaultValue:"userName",options:[{label:"用户名称",value:"userName"},{label:"真实姓名",value:"realName"},{label:"身份证号",value:"idCardNo"},{label:"邮箱",value:"email"},{label:"手机号码",value:"phoneNumber"}]},{type:"dateTimeSearch",field:"dateTime",selectField:"commonTime",defaultValue:void 0,selectDefaultValue:"startTime,endTime",options:[{label:"创建时间",value:"startTime,endTime"},{label:"更新时间",value:"updateTime"}]},{type:"select",field:"sex",defaultValue:void 0,placeholder:"请选择用户性别",options:[{label:"男",value:1},{label:"女",value:0}]},{type:"select",field:"userState",defaultValue:void 0,placeholder:"请选择用户状态",options:[{label:"禁用",value:0},{label:"启用",value:1}]},{type:"select",field:"authState",defaultValue:void 0,placeholder:"请选择认证状态",options:[{label:"未实名",value:0},{label:"认证中",value:1},{label:"已实名",value:2},{label:"认证失败",value:3}]},{type:"select",field:"userRole",defaultValue:void 0,placeholder:"请选择用户角色",options:[{label:"超级管理员",value:"超级管理员"},{label:"管理员",value:"管理员"},{label:"普通用户",value:"普通用户"}]},{type:"select",field:"registerFrom",defaultValue:void 0,placeholder:"请选择用户注册于",options:[{label:"官网",value:0},{label:"小程序",value:1},{label:"pc管理端",value:2}]}]},btnConfigList:[{btnText:"新增用户",type:"primary",power:"getTransportNode"},{btnText:"审批实名",type:"primary",power:"approvalIdentify"},{btnText:"批量操作",btnType:"dropdown",afterIcon:"down",ghost:!0,power:"batchOperation",menuItems:[{btnText:"删除",icon:"delete",style:"color:red;",power:"batchDelete"},{btnText:"禁用",icon:"lock",power:"batchDisabled"},{btnText:"启用",style:"color:green",icon:"unlock",power:"batchEnabled"}]}],fieldsConfig:{name:"用户管理",id:"userManage",database:{"用户名称":"userName","用户图片":"userImg","用户角色":"userRole","用户状态":"userState","认证状态":"authState","真实姓名":"realName","身份证号":"idCardNo","手机号码":"phoneNumber","性别":"sex","生日":"birthday","年龄":"age","邮箱":"email","省份":"province","城市":"city","区/县":"area","详细地址":"address","备注":"remark","注册于":"registerFrom","用户标签":"userTags","创建时间":"createdAt","更新时间":"updatedAt"},specColumns:[{headerName:"用户名称",field:"userName",headerClass:e=>{const t=e.colDef.headerName;return"用户名称"===t?"firstSpecialStyles":"firstcommonStyles"}},{headerName:"认证状态",field:"authState",cellRenderer:e=>{if("bottom"!==e.node.rowPinned)return 0===e.value?"未实名":1===e.value?"认证中":2===e.value?"已实名":3===e.value?"认证失败":""}},{headerName:"用户状态",field:"userState",cellRenderer:e=>{if("bottom"!==e.node.rowPinned)return 1==e.value?'<span style="color:yellowgreen;font-weight:bold;">启用</span>':0===e.value?'<span style="color:tomato;font-weight:bold;">禁用</span>':'<span style="color:tomato;font-weight:bold;">注销</span>'}},{headerName:"性别",field:"sex",cellRenderer:e=>{if("bottom"!==e.node.rowPinned)return 0===e.value?"女":"男"}},{headerName:"注册于",field:"registerFrom",cellRenderer:e=>{if("bottom"!==e.node.rowPinned)return 0===e.value?"官网":1===e.value?"小程序":"pc管理端"}}],actionColumns:[{headerName:"操作",field:"agTableAction",width:170,cellRendererFramework:"AgRowActionBtn"}]},selectedRowInfo:null,openAddUser:!1}},methods:{getCustmoerGridOptions(e){const t={rowHeight:80,headerHeight:60,rowStyle:{backgroundColor:"#efefef"},getRowHeight:function(e){return"bottom"===e.node.rowPinned?36:80}};return t},getCustomerDefaultColDef(){return{cellStyle:function(e){return"bottom"===e.node.rowPinned?{color:"#333","line-height":"36px",height:"36px"}:{"line-height":"80px"}}}},searchQuery(e){this.$refs.BLHeaderSearch.searchQuery(e)},getList(e){const{pageSize:t,pageNum:a,filterChangedObj:s}=this.agQueryParams;this.agQueryParams.queryParam.isRealField=!0,this.agQueryParams.getDataLoading=!0,1===a&&(this.agTableOptions.rowData=null),this.rowSelectedList=null,(0,l.w3)({pageSize:t,pageNum:a,queryParams:{...e||{},...s.filterObj||{}}}).then((e=>{if(b.log("res123======>",e),200===e?.code){const{data:t,total:s=0,pages:i}=e;this.agQueryParams.total=s,this.agQueryParams.totalPages=i,this.agTableOptions.rowData=a<=1?Object.freeze(t):Object.freeze([...this.agTableOptions.rowData,...t])}else this.$message.error(e.message||"查询列表失败")})).finally((()=>{this.agQueryParams.getDataLoading=!1}))},agTableRowOperation(e){const{params:t,btnText:a}=e;b.log("params",t);const s=t.data;switch(this.selectedRowInfo=s,a){case"编辑":b.log("编辑"),this.openEditUserFun(s);break;case"禁用":b.log("禁用"),this.toggleStatus([s],0);break;case"启用":b.log("启用"),this.toggleStatus([s],1);break;case"删除":b.log("删除"),this.deleteConfirm(s.id);break}},openEditUserFun(e){this.selectedRowInfo=e,this.openAddUser=!0},toggleStatus(e,t){if(b.log("启用/禁用",e),b.log("启用/userState",t),e?.length){const a=this,s=e.map((e=>e.id)).join(","),i=0===t?"禁用":"启用";this.$confirm({title:"温馨提示",content:`您确认${i}吗`,onOk:async function(){b.log("提交");const e=await(0,l.j7)({ids:s,userState:t});200===e.code?(a.$message.success(`${i}成功`),a.getList(a.agQueryParams.queryParam)):a.$message.warning(e.message||`${i}失败`)}})}else this.$message.warning("未选择行数据")},deleteConfirm(e){const t=this;this.$confirm({title:"操作确认",content:"删除后无法恢复，您是否确认删除?",onOk:async function(){b.log("提交");const a=await(0,l.fQ)({ids:e});200===a.code?(t.$message.success("删除成功"),t.getList(t.agQueryParams.queryParam)):t.$message.warning(a.message||"删除失败")}})},batchDelData(e){if(e?.length){const t=e.map((e=>e.id)).join(",");this.deleteConfirm(t)}else this.$message.warning("未选择数据")},headerBtnOperation(e){b.log("头部按钮操作",e);const{btnText:t}=e;switch(b.log("this.rowSelectedList",this.rowSelectedList),t){case"新增用户":b.log("新增用户"),this.selectedRowInfo=null,this.openAddUser=!0;break;case"删除":b.log("删除");break;case"禁用":b.log("禁用");break;case"启用":b.log("启用");break;case"批量操作-删除":b.log("批量操作-删除"),this.batchDelData(this.rowSelectedList);break;case"批量操作-禁用":b.log("批量操作-禁用"),this.toggleStatus(this.rowSelectedList,0);break;case"批量操作-启用":b.log("批量操作-启用"),this.toggleStatus(this.rowSelectedList,1);break}}}},y=f,w=(0,h.A)(y,s,i,!1,null,"1e2d1199",null),v=w.exports}}]);
//# sourceMappingURL=17.b047ae28.js.map